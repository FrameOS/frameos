import { useValues } from 'kea'
import { frameLogic } from '../../frameLogic'
import { sceneSourceLogic } from './sceneSourceLogic'
import { Spinner } from '../../../../components/Spinner'
import Editor, { Monaco } from '@monaco-editor/react'
import { panelsLogic } from '../panelsLogic'

export function SceneSource() {
  const { frame } = useValues(frameLogic)
  const { selectedSceneId } = useValues(panelsLogic({ frameId: frame.id }))
  const { sceneSource, sceneSourceLoading } = useValues(
    sceneSourceLogic({ frameId: frame.id, sceneId: selectedSceneId })
  )
  function beforeMount(monaco: Monaco) {
    monaco.editor.defineTheme('darkframe', {
      base: 'vs-dark',
      inherit: true,
      rules: [],
      colors: { 'editor.background': '#000000' },
    })
  }
  return (
    <div className="space-y-2 h-full">
      {sceneSource === '' && sceneSourceLoading ? (
        <Spinner />
      ) : (
        <Editor
          height="100%"
          path={`${frame.id}/scenes/default.nim`}
          language="python" // no nim support :/
          value={'# This code is autogenerated\n' + sceneSource}
          theme="darkframe"
          beforeMount={beforeMount}
          options={{ minimap: { enabled: false } }}
        />
      )}
    </div>
  )
}
